"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ShareableCanvas=function(){function ShareableCanvas(options){var _this=this;_classCallCheck(this,ShareableCanvas),this.initialized=!0,this.changed=!1,this.container=options.container,this.canvas=document.getElementById(options.container),this.fingers=[],this.stage=new createjs.Stage(this.container),this.stage.addEventListener("mousedown",function(event){return _this.stageMouseDown(event)}),this.stage.addEventListener("pressmove",function(event){return _this.stagePressMove(event)}),this.stage.addEventListener("pressup",function(event){return _this.stagePressUp(event)}),createjs.Touch.enable(this.stage)}return _createClass(ShareableCanvas,[{key:"stageMouseDown",value:function(event){this.fingers[event.pointerID]={start:{x:event.stageX,y:event.stageY},current:{x:event.stageX,y:event.stageY},old:{x:event.stageX,y:event.stageY}},this.calculateActiveFingers(),this.stage.dispatchEvent("start")}},{key:"stagePressMove",value:function(event){var pointerID=event.pointerID;this.fingers[pointerID].current.x=event.stageX,this.fingers[pointerID].current.y=event.stageY,void 0!==event.localX&&(this.fingers[pointerID].local={x:null,y:null},this.fingers[pointerID].local.x=event.localX,this.fingers[pointerID].local.y=event.localY),this.calculateActiveFingers(),this.changed=!0,this.update()}},{key:"stagePressUp",value:function(event){this.fingers[event.pointerID]&&delete this.fingers[event.pointerID],this.calculateActiveFingers(),this.stage.dispatchEvent("complete"),this.update()}},{key:"enterFrame",value:function(event){if(this.stage.dispatchEvent("update"),this.changed){this.changed=!1;for(var pointerID in self.fingers)self.fingers[pointerID].start&&(self.fingers[pointerID].old.x=self.fingers[pointerID].current.x,self.fingers[pointerID].old.y=self.fingers[pointerID].current.y)}}},{key:"calculateActiveFingers",value:function(){this.activeFingers=0;for(var pointerID in this.fingers)this.fingers[pointerID].start&&this.activeFingers++}},{key:"update",value:function(event){this.stage.update()}},{key:"transform",value:function(event){if(this.activeFingers>1){var points=[];for(var k in this.fingers)if(this.fingers[k].current&&(points.push(this.fingers[k]),points.length>=2))break;var point1=points[0].old,point2=points[1].old,startAngle=Math.atan2(point1.y-point2.y,point1.x-point2.x)*(180/Math.PI);point1=points[0].current,point2=points[1].current;var currentAngle=Math.atan2(point1.y-point2.y,point1.x-point2.x)*(180/Math.PI),angle=currentAngle-startAngle;event.currentTarget.rotation+=.02*angle,this.stage.dispatchEvent("rotate");var distance=this.getDistance(points[0].current,points[1].current)/this.getDistance(points[0].old,points[1].old);if(distance>1.01||distance<.9){distance=1-distance;var scale=event.currentTarget.scaleX*distance*-.02;event.currentTarget.scaleX+=scale,event.currentTarget.scaleY=event.currentTarget.scaleX,this.stage.dispatchEvent("scale")}}var average={x:0,y:0};for(var pointerID in this.fingers)this.fingers[pointerID].start&&(average.x+=this.fingers[pointerID].current.x-this.fingers[pointerID].old.x,average.y+=this.fingers[pointerID].current.y-this.fingers[pointerID].old.y);average.x/=Math.max(1,this.activeFingers),average.y/=Math.max(1,this.activeFingers),event.currentTarget.x=event.currentTarget.localX+average.x,event.currentTarget.y=event.currentTarget.localY+average.y,this.stage.dispatchEvent("move")}},{key:"savePosition",value:function(event){event.currentTarget.localX=event.currentTarget.x,event.currentTarget.localY=event.currentTarget.y}},{key:"drawCircle",value:function(){var circle=new createjs.Shape;circle.graphics.beginFill("DeepSkyBlue").drawCircle(0,0,50),circle.x=100,circle.y=100,this.stage.addChild(circle),this.update()}},{key:"drawBackground",value:function(){var background=new createjs.Shape;background.graphics.beginFill("Black").drawRect(0,0,this.canvas.width,this.canvas.width),this.stage.addChild(background),this.update()}},{key:"loadImage",value:function(path,fixSize){var _this2=this,image=new Image;image.src=path,image.onload=function(event,fixSize){var loadedImage=event.target;_this2.addImage(loadedImage)}}},{key:"addImage",value:function(image,alpha,fittingRatio){var _this3=this,bitmap=new createjs.Bitmap(image);bitmap.alpha=alpha;var bounds=bitmap.getBounds(),ratio=bounds.height/bounds.width;if(ratio>fittingRatio)var scale=this.canvas.width/bounds.width;else var scale=this.canvas.height/bounds.height;bitmap.scaleY=scale,bitmap.scaleX=scale,bitmap.addEventListener("mousedown",function(event){return _this3.savePosition(event)}),bitmap.addEventListener("pressmove",function(event){return _this3.transform(event)}),this.stage.addChild(bitmap),this.update()}},{key:"getDistance",value:function(p1,p2){var x=p2.x-p1.x,y=p2.y-p1.y;return Math.sqrt(x*x+y*y)}},{key:"getMidPoint",value:function(p1,p2){var midPoint={x:null,y:null};return midPoint.x=p1.x+p2.x/2,midPoint.y=p1.y+p2.y/2,midPoint}},{key:"addQuote",value:function(sourceText,fontSize,addQuotes){var text=void 0;text=addQuotes?"\t\t\t\t\t“"+sourceText+"”":"\t\t\t\t\t"+sourceText;var quote=new createjs.Text(text,fontSize+"px georgia","#ffffff");quote.textBaseline="alphabetic",quote.x=50,quote.y=100,quote.lineWidth=1100,quote.lineHeight=1.7*fontSize,this.stage.addChild(quote),this.update()}},{key:"addTitle",value:function(titleText){var title=new createjs.Text(titleText,"23px helvetica, sans-serif","#ffffff");title.textBaseline="alphabetic",title.x=200,title.y=542,title.lineWidth=1e3,title.lineHeight=30,this.stage.addChild(title),this.update()}},{key:"addUrl",value:function(urlLink){var url=new createjs.Text(urlLink,"14px helvetica, sans-serif","#ffffff");url.textBaseline="alphabetic",url.x=200,url.y=572,url.lineWidth=1e3,url.lineHeight=30,this.stage.addChild(url),this.update()}},{key:"addLogo",value:function(scale){var _this4=this,image=new Image;image.src=ShareableVars.pluginurl+"/admin/img/nm-white-logo.svg",image.onload=function(event){var logo=new createjs.Bitmap(event.target),bounds=logo.getBounds();logo.scaleX=scale,logo.scaleY=scale,logo.x=50,logo.y=_this4.canvas.height-(bounds.height*scale+50),logo.rotation=-3.15,_this4.stage.addChild(logo),_this4.update()}}}]),ShareableCanvas}();
//# sourceMappingURL=sourcemaps/shareable-canvas.js.map
