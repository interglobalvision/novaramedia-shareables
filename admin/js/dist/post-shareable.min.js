"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),$=jQuery,Shareables=function(){function Shareables(){_classCallCheck(this,Shareables),this.container=$(".shareable-container"),this.$recentPostsSelect=$("#shareable-post-latest-select"),this.$postIdInput=$("#shareable-post-id"),this.$postTitleField=$("#shareable-post-title"),this.$postImageField=$("#shareable-post-image"),this.$postTextField=$("#shareable-post-text"),this.$postUrlField=$("#shareable-post-url"),this.canvas=new ShareableCanvas({container:"canvas-container"}),this.bind(),this.$postIdInput.val()?this.getPostData():this.setUrlFromSelect()}return _createClass(Shareables,[{key:"bind",value:function(){var _this=this;this.$recentPostsSelect.on("change",function(){return _this.setUrlFromSelect()}),$("#get-post-data").on("click",function(){return _this.getPostData()}),$("#generate-shareable").on("click",function(){return _this.generateShareable()}),$("#download-shareable").on("click",function(){return _this.downloadShareable()})}},{key:"setUrlFromSelect",value:function(){this.$postIdInput.val(this.$recentPostsSelect.val()),this.getPostData()}},{key:"getPostData",value:function(){var _this2=this,postID=this.$postIdInput.val();if(void 0===postID)return alert("Invalid post ID");var data={action:"get_post_data",postId:postID};jQuery.ajax({url:ShareableVars.ajaxurl,type:"get",data:data,success:function(response){return _this2.ajaxSuccess(response,status)}})}},{key:"ajaxSuccess",value:function(response,status){response?"success"!==response.type?(console.error(response.error),alert(response.error)):"success"===response.type&&(this.fillData(response.postData),this.generateShareable()):(console.error(response.error),alert(response.error))}},{key:"stripHTML",value:function(text){var tmp=document.createElement("DIV");return tmp.innerHTML=text,tmp.textContent||tmp.innerText||""}},{key:"fillData",value:function(data){this.$postTitleField.val(data.post_title),this.$postImageField.val(data.post_image),this.$postTextField.val(this.stripHTML(data.post_content)),this.$postUrlField.val(data.post_permalink)}},{key:"generateShareable",value:function(){var _this3=this;this.canvas.stage.clear(),this.canvas.update();var title=this.$postTitleField.val(),image=this.$postImageField.val(),text=this.$postTextField.val(),fontSize=$("input[name=shareable-font-size]:checked").val(),addQuotes=!1;$("#shareable-checkbox-boolean").is(":checked")&&(addQuotes=!0);var link=this.$postUrlField.val(),loadedImage=new Image;loadedImage.src=image,loadedImage.crossOrigin="Anonymous",loadedImage.onload=function(event){_this3.canvas.drawBackground(),_this3.canvas.addImage(loadedImage,.3,.5225),_this3.canvas.addQuote(text,fontSize,addQuotes),_this3.canvas.addTitle(title),_this3.canvas.addUrl(link),_this3.canvas.addLogo(.11)}}},{key:"downloadShareable",value:function(){var filename=this.toSlug(this.$postTitleField.val())+"-post-shareable.png",link=document.getElementById("download-shareable");link.href=this.canvas.canvas.toDataURL(),link.download=filename}},{key:"toSlug",value:function(text){return text.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}}]),Shareables}();jQuery(window).load(function(){new Shareables});
//# sourceMappingURL=sourcemaps/post-shareable.js.map
