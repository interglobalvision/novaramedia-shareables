"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var s=a[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(a,t,s){return t&&e(a.prototype,t),s&&e(a,s),a}}(),$=jQuery,Shareables=function(){function e(){_classCallCheck(this,e),this.postTitleField=$("#shareable-post-title"),this.postImageField=$("#shareable-post-image"),this.postTextField=$("#shareable-post-text"),this.postUrlField=$("#shareable-post-url"),this.canvas=new ShareableCanvas({container:"canvas-container"}),this.bind(),this.postUrlField.val()&&this.getPostData()}return _createClass(e,[{key:"bind",value:function(){var e=this;$("#shareable-latest-posts").on("change",function(){return e.selectSetData($("#shareable-latest-posts").val())}),$("#get-post-data").on("click",function(){return e.getPostData($("#shareable-post-url").val())}),$("#generate-shareable").on("click",function(){return e.generateShareable()}),$("#download-shareable").on("click",function(){return e.downloadShareable()})}},{key:"selectSetData",value:function(e){this.postUrlField.val(e),this.getPostData(e)}},{key:"getPostData",value:function(){var e=this,a=$("#shareable-post-url").val();if(void 0===a)return alert("Invalid post ID");var t={action:"get_post_data",postUrl:a};jQuery.ajax({url:ShareableVars.ajaxurl,type:"get",data:t,success:function(a){return e.ajaxSuccess(a,status)}})}},{key:"ajaxSuccess",value:function(e,a){console.log("response",e),console.log("status",a),e?"success"!==e.type?(console.error(e.error),alert(e.error)):"success"===e.type&&this.fillData(e.postData):(console.error(e.error),alert(e.error))}},{key:"stripHTML",value:function(e){var a=document.createElement("DIV");return a.innerHTML=e,a.textContent||a.innerText||""}},{key:"fillData",value:function(e){this.postTitleField.val(e.post_title),this.postImageField.val(e.post_image),this.postTextField.val(this.stripHTML(e.post_content))}},{key:"generateShareable",value:function(){var e=this;this.canvas.stage.clear(),this.canvas.update();var a=this.postTitleField.val(),t=this.postImageField.val(),s=this.postTextField.val();if(s.length>454)return alert("Text is too long");var n=this.postUrlField.val(),l=new Image;l.src=t,l.onload=function(l){e.canvas.drawBackground(),e.canvas.addImage(t),e.canvas.addQuote(s),e.canvas.addTitle(a),e.canvas.addUrl(n),e.canvas.addLogo()}}},{key:"downloadShareable",value:function(){var e=this.toSlug(this.postTitleField.val())+".png",a=document.getElementById("download-shareable");a.href=this.canvas.canvas.toDataURL(),a.download=e}},{key:"toSlug",value:function(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}}]),e}();jQuery(window).load(function(){new Shareables});
//# sourceMappingURL=admin/js/novaramedia-shareables.min.js.map
