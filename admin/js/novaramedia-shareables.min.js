"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),$=jQuery,Shareables=function(){function e(){_classCallCheck(this,e),this.container=$(".shareable-container"),this.$recentPostsSelect=$("#shareable-post-latest-select"),this.$postIdInput=$("#shareable-post-id"),this.$postTitleField=$("#shareable-post-title"),this.$postImageField=$("#shareable-post-image"),this.$postTextField=$("#shareable-post-text"),this.$postUrlField=$("#shareable-post-url"),this.canvas=new ShareableCanvas({container:"canvas-container"}),this.bind(),this.$postIdInput.val()?this.getPostData():this.setUrlFromSelect()}return _createClass(e,[{key:"bind",value:function(){var e=this;this.$recentPostsSelect.on("change",function(){return e.setUrlFromSelect()}),$("#get-post-data").on("click",function(){return e.getPostData()}),$("#generate-shareable").on("click",function(){return e.generateShareable()}),$("#download-shareable").on("click",function(){return e.downloadShareable()})}},{key:"setUrlFromSelect",value:function(){this.$postIdInput.val(this.$recentPostsSelect.val()),this.getPostData()}},{key:"getPostData",value:function(){var e=this,t=this.$postIdInput.val();if(void 0===t)return alert("Invalid post ID");var a={action:"get_post_data",postId:t};jQuery.ajax({url:ShareableVars.ajaxurl,type:"get",data:a,success:function(t){return e.ajaxSuccess(t,status)}})}},{key:"ajaxSuccess",value:function(e,t){e?"success"!==e.type?(console.error(e.error),alert(e.error)):"success"===e.type&&(this.fillData(e.postData),this.generateShareable()):(console.error(e.error),alert(e.error))}},{key:"stripHTML",value:function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}},{key:"fillData",value:function(e){this.$postTitleField.val(e.post_title),this.$postImageField.val(e.post_image),this.$postTextField.val(this.stripHTML(e.post_content)),this.$postUrlField.val(e.post_permalink)}},{key:"generateShareable",value:function(){var e=this;this.canvas.stage.clear(),this.canvas.update();var t=this.$postTitleField.val(),a=this.$postImageField.val(),s=this.$postTextField.val(),n=$("input[name=shareable-font-size]:checked").val(),r=!1;$("#shareable-checkbox-boolean").is(":checked")&&(r=!0);var l=this.$postUrlField.val(),o=new Image;o.src=a,o.onload=function(o){e.canvas.drawBackground(),e.canvas.addImage(a),e.canvas.addQuote(s,n,r),e.canvas.addTitle(t),e.canvas.addUrl(l),e.canvas.addLogo()}}},{key:"downloadShareable",value:function(){var e=this.toSlug(this.$postTitleField.val())+"-post-shareable.png",t=document.getElementById("download-shareable");t.href=this.canvas.canvas.toDataURL(),t.download=e}},{key:"toSlug",value:function(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}}]),e}();jQuery(window).load(function(){new Shareables});
//# sourceMappingURL=admin/js/novaramedia-shareables.min.js.map
